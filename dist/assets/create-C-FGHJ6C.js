import{j as e,b9 as he,M,aV as N,aX as K,aW as O,bu as me,bv as je,bw as ue,b0 as pe,G as t,t as d,b3 as j,aj as C,y as w,ah as ye,B as g,z as D,b4 as _,a_ as Y,a$ as Z,T as o,d as f,af as fe,ab as ee,bx as ge,a6 as be,be as Ie,bd as Ce,P as ie,aT as ne,aO as we}from"./index-DWuWYdwO.js";import{C as _e}from"./CircularLoader-Bd6WMJyi.js";import{A as te,I as Te,a as Ae}from"./InvoiceModal-CwcyBTIA.js";import{i as qe}from"./incrementer-QD2bX8Yz.js";import{u as Pe,a as De,h as re,b as se,s as Fe,c as B,i as Se}from"./invoice-CtEBVet3.js";import{v as de}from"./v4-D8aEg3BZ.js";import{D as oe}from"./DatePicker-C89fNkAL.js";import{T as ke,a as Le,b as Ne}from"./TableContainer-DaSqANyU.js";import{T as Oe}from"./TableHead-UeT6rlXJ.js";import{T as ce}from"./TableRow-Cu26Yl8o.js";import{T as u}from"./TableCell-DifTD_db.js";import"./DeleteOutlined-Ce9XbAuj.js";import"./Skeleton-Cqh1Sn3g.js";import"./react-pdf.browser-fdpOy0uw.js";import"./index-DROKURrI.js";import"./index-CaepUFAR.js";import"./index-WhEdw1H0.js";import"./DownloadOutlined-cTRsJVoi.js";import"./dateViewRenderers-Dv6mi70Y.js";import"./DesktopDatePicker-C2FLjWfN.js";import"./useMobilePicker-CuOEMUMP.js";const Be=N({date:K().required("Invoice date is required"),due_date:K().when("date",(p,c)=>p&&c.min(p,"Due date can't be before invoice date")).nullable().required("Due date is required"),customerInfo:N({name:O().required("Invoice receiver information is required")}).required("Invoice receiver information is required"),status:O().required("Status selection is required"),invoice_detail:me().required("Invoice details is required").of(N().shape({name:O().required("Product name is required")})).min(1,"Invoice must have at least 1 items")});function ae({lists:p,invoiceMaster:c}){const T=je(),A=500,F=s=>{var l,q,i;const r={id:Number(qe(p.length)),invoice_id:Number(s.invoice_id),customer_name:(l=s.cashierInfo)==null?void 0:l.name,email:(q=s.cashierInfo)==null?void 0:q.email,avatar:Number(Math.round(Math.random()*10)),discount:Number(s.discount),tax:Number(s.tax),date:ne(s.date,"MM/dd/yyyy"),due_date:ne(s.due_date,"MM/dd/yyyy"),quantity:Number((i=s.invoice_detail)==null?void 0:i.reduce((S,y)=>S+y.qty,0)),status:s.status,cashierInfo:s.cashierInfo,customerInfo:s.customerInfo,invoice_detail:s.invoice_detail,notes:s.notes};Se(r),we({open:!0,message:"Invoice Added successfully",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"alert",alert:{color:"success"}}),T("/apps/invoice/list")};return e.jsx(ue,{initialValues:{id:120,invoice_id:Date.now(),status:"",date:new Date,due_date:null,cashierInfo:{name:"Belle J. Richter",address:"1300 Cooks Mine, NM 87829",phone:"305-829-7809",email:"belljrc23@gmail.com"},customerInfo:{address:"",email:"",name:"",phone:""},invoice_detail:[{id:de(),name:"",description:"",qty:1,price:"1.00"}],discount:0,tax:0,notes:""},validationSchema:Be,onSubmit:s=>{F(s)},children:({handleBlur:s,errors:r,handleChange:l,handleSubmit:q,values:i,isValid:S,setFieldValue:y,touched:x})=>{var $,H,z,R,E,G,W,U,v;const b=i==null?void 0:i.invoice_detail.reduce((n,a)=>a.name.trim().length>0?n+Number(a.price*Math.floor(a.qty)):n,0),k=i.tax*b/100,L=i.discount*b/100,P=b-L+k;return e.jsx(pe,{onSubmit:q,children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(d,{spacing:1,children:[e.jsx(j,{children:"Invoice Id"}),e.jsx(C,{sx:{width:"100%"},children:e.jsx(w,{required:!0,disabled:!0,type:"number",name:"invoice_id",id:"invoice_id",value:i.invoice_id,onChange:l})})]})}),e.jsxs(t,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(d,{spacing:1,children:[e.jsx(j,{children:"Status"}),e.jsx(C,{sx:{width:"100%"},children:e.jsxs(ye,{value:i.status,displayEmpty:!0,name:"status",renderValue:n=>n.length===0?e.jsx(g,{sx:{color:"secondary.400"},children:"Select status"}):n,onChange:l,error:!!(r.status&&x.status),children:[e.jsx(D,{disabled:!0,value:"",children:"Select status"}),e.jsx(D,{value:"Paid",children:"Paid"}),e.jsx(D,{value:"Unpaid",children:"Unpaid"}),e.jsx(D,{value:"Cancelled",children:"Cancelled"})]})})]}),x.status&&r.status&&e.jsx(_,{error:!0,children:r.status})]}),e.jsxs(t,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(d,{spacing:1,children:[e.jsx(j,{children:"Date"}),e.jsx(C,{sx:{width:"100%"},error:!!(x.date&&r.date),children:e.jsx(Y,{dateAdapter:Z,children:e.jsx(oe,{format:"dd/MM/yyyy",value:i.date,onChange:n=>y("date",n)})})})]}),x.date&&r.date&&e.jsx(_,{error:!0,children:r.date})]}),e.jsxs(t,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(d,{spacing:1,children:[e.jsx(j,{children:"Due Date"}),e.jsx(C,{sx:{width:"100%"},error:!!(x.due_date&&r.due_date),children:e.jsx(Y,{dateAdapter:Z,children:e.jsx(oe,{format:"dd/MM/yyyy",value:i.due_date,onChange:n=>y("due_date",n)})})})]}),x.due_date&&r.due_date&&e.jsx(_,{error:!0,children:r.due_date})]}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(M,{sx:{minHeight:168},children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{item:!0,xs:12,sm:8,children:e.jsxs(d,{spacing:2,children:[e.jsx(o,{variant:"h5",children:"From:"}),e.jsxs(d,{sx:{width:"100%"},children:[e.jsx(o,{variant:"subtitle1",children:($=i==null?void 0:i.cashierInfo)==null?void 0:$.name}),e.jsx(o,{color:"secondary",children:(H=i==null?void 0:i.cashierInfo)==null?void 0:H.address}),e.jsx(o,{color:"secondary",children:(z=i==null?void 0:i.cashierInfo)==null?void 0:z.phone}),e.jsx(o,{color:"secondary",children:(R=i==null?void 0:i.cashierInfo)==null?void 0:R.email})]})]})}),e.jsx(t,{item:!0,xs:12,sm:4,children:e.jsxs(g,{textAlign:{xs:"left",sm:"right"},color:"grey.200",children:[e.jsx(f,{variant:"outlined",startIcon:e.jsx(fe,{}),color:"secondary",onClick:()=>re(!0),size:"small",children:"Change"}),e.jsx(te,{open:c.open,setOpen:n=>re(n),handlerAddress:n=>y("cashierInfo",n)})]})})]})})}),e.jsxs(t,{item:!0,xs:12,sm:6,children:[e.jsx(M,{sx:{minHeight:168},children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{item:!0,xs:12,sm:8,children:e.jsxs(d,{spacing:2,children:[e.jsx(o,{variant:"h5",children:"To:"}),e.jsxs(d,{sx:{width:"100%"},children:[e.jsx(o,{variant:"subtitle1",children:(E=i==null?void 0:i.customerInfo)==null?void 0:E.name}),e.jsx(o,{color:"secondary",children:(G=i==null?void 0:i.customerInfo)==null?void 0:G.address}),e.jsx(o,{color:"secondary",children:(W=i==null?void 0:i.customerInfo)==null?void 0:W.phone}),e.jsx(o,{color:"secondary",children:(U=i==null?void 0:i.customerInfo)==null?void 0:U.email})]})]})}),e.jsx(t,{item:!0,xs:12,sm:4,children:e.jsxs(g,{textAlign:"right",color:"grey.200",children:[e.jsx(f,{size:"small",startIcon:e.jsx(ee,{}),color:"secondary",variant:"outlined",onClick:()=>se(!0),children:"Add"}),e.jsx(te,{open:c.isCustomerOpen,setOpen:n=>se(n),handlerAddress:n=>y("customerInfo",n)})]})})]})}),x.customerInfo&&r.customerInfo&&e.jsx(_,{error:!0,children:(v=r==null?void 0:r.customerInfo)==null?void 0:v.name})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(o,{variant:"h5",children:"Detail"})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(ge,{name:"invoice_detail",render:({remove:n,push:a})=>{var h,I,J,Q,V,X;return e.jsxs(e.Fragment,{children:[e.jsx(ke,{children:e.jsxs(Le,{sx:{minWidth:650},children:[e.jsx(Oe,{children:e.jsxs(ce,{children:[e.jsx(u,{children:"#"}),e.jsx(u,{children:"Name"}),e.jsx(u,{children:"Description"}),e.jsx(u,{children:"Qty"}),e.jsx(u,{children:"Price"}),e.jsx(u,{align:"right",children:"Amount"}),e.jsx(u,{align:"center",children:"Action"})]})}),e.jsx(Ne,{children:(h=i.invoice_detail)==null?void 0:h.map((m,le)=>e.jsxs(ce,{children:[e.jsx(u,{children:i.invoice_detail.indexOf(m)+1}),e.jsx(Te,{id:m.id,index:le,name:m.name,description:m.description,qty:m.qty,price:m.price,onDeleteItem:xe=>n(xe),onEditItem:l,Blur:s,errors:r,touched:x},m.id)]},m.id))})]})}),e.jsx(be,{}),x.invoice_detail&&r.invoice_detail&&!Array.isArray(r==null?void 0:r.invoice_detail)&&e.jsx(d,{direction:"row",justifyContent:"center",sx:{p:1.5},children:e.jsx(_,{error:!0,children:r.invoice_detail})}),e.jsxs(t,{container:!0,justifyContent:"space-between",children:[e.jsx(t,{item:!0,xs:12,md:8,children:e.jsx(g,{sx:{pt:2.5,pr:2.5,pb:2.5,pl:0},children:e.jsx(f,{color:"primary",startIcon:e.jsx(ee,{}),onClick:()=>a({id:de(),name:"",description:"",qty:1,price:"1.00"}),variant:"dashed",sx:{bgcolor:"transparent !important"},children:"Add Item"})})}),e.jsxs(t,{item:!0,xs:12,md:4,children:[e.jsxs(t,{container:!0,justifyContent:"space-between",spacing:2,sx:{pt:2.5,pb:2.5},children:[e.jsx(t,{item:!0,xs:6,children:e.jsxs(d,{spacing:1,children:[e.jsx(j,{children:"Discount(%)"}),e.jsx(w,{type:"number",fullWidth:!0,name:"discount",id:"discount",placeholder:"0.0",value:i.discount,onChange:l,inputProps:{min:0}})]})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(d,{spacing:1,children:[e.jsx(j,{children:"Tax(%)"}),e.jsx(w,{type:"number",fullWidth:!0,name:"tax",id:"tax",placeholder:"0.0",value:i.tax,onChange:l,inputProps:{min:0}})]})})]}),e.jsx(t,{item:!0,xs:12,children:e.jsxs(d,{spacing:2,children:[e.jsxs(d,{direction:"row",justifyContent:"space-between",children:[e.jsx(o,{color:"grey.500",children:"Sub Total:"}),e.jsx(o,{children:((I=c.country)==null?void 0:I.prefix)+""+b.toFixed(2)})]}),e.jsxs(d,{direction:"row",justifyContent:"space-between",children:[e.jsx(o,{color:"grey.500",children:"Discount:"}),e.jsx(o,{variant:"h6",color:"success.main",children:((J=c.country)==null?void 0:J.prefix)+""+L.toFixed(2)})]}),e.jsxs(d,{direction:"row",justifyContent:"space-between",children:[e.jsx(o,{color:"grey.500",children:"Tax:"}),e.jsx(o,{children:((Q=c.country)==null?void 0:Q.prefix)+""+k.toFixed(2)})]}),e.jsxs(d,{direction:"row",justifyContent:"space-between",children:[e.jsx(o,{variant:"subtitle1",children:"Grand Total:"}),e.jsx(o,{variant:"subtitle1",children:P%1===0?((V=c.country)==null?void 0:V.prefix)+""+P:((X=c.country)==null?void 0:X.prefix)+""+P.toFixed(2)})]})]})})]})]})]})}})}),e.jsx(t,{item:!0,xs:12,children:e.jsxs(d,{spacing:1,children:[e.jsx(j,{children:"Notes"}),e.jsx(w,{placeholder:"Address",rows:3,value:i.notes,multiline:!0,name:"notes",onChange:l,inputProps:{maxLength:A},helperText:`${i.notes.length} / ${A}`,sx:{width:"100%","& .MuiFormHelperText-root":{mr:0,display:"flex",justifyContent:"flex-end"}}})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(d,{spacing:1,children:[e.jsx(j,{children:"Set Currency*"}),e.jsx(C,{sx:{width:{xs:"100%",sm:250}},children:e.jsx(Ie,{id:"country-select-demo",fullWidth:!0,options:c.countries,defaultValue:c.countries[2],value:c.countries.find(n=>{var a;return n.code===((a=c.country)==null?void 0:a.code)}),onChange:(n,a)=>Fe(a),autoHighlight:!0,getOptionLabel:n=>n.label,renderOption:({key:n,...a},h)=>e.jsxs(g,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...a,children:[h.code&&e.jsx("img",{loading:"lazy",width:"20",src:`https://flagcdn.com/w20/${h.code.toLowerCase()}.png`,alt:"flag"}),h.label]},n),renderInput:n=>{const a=c.countries.find(h=>{var I;return h.code===((I=c.country)==null?void 0:I.code)});return e.jsx(w,{...n,name:"phoneCode",placeholder:"Select",InputProps:{...n.InputProps,startAdornment:e.jsx(e.Fragment,{children:a&&a.code!==""&&e.jsx("img",{style:{marginRight:6},loading:"lazy",width:"20",src:`https://flagcdn.com/w20/${a.code.toLowerCase()}.png`,alt:"flag"})})},inputProps:{...n.inputProps,autoComplete:"new-password"}})}})})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(d,{direction:"row",justifyContent:"flex-end",alignItems:"flex-end",spacing:2,sx:{height:"100%"},children:[e.jsx(f,{variant:"outlined",color:"secondary",disabled:i.status===""||!S,sx:{color:"secondary.dark"},onClick:()=>B(!0),children:"Preview"}),e.jsx(f,{variant:"outlined",color:"secondary",sx:{color:"secondary.dark"},children:"Save"}),e.jsx(f,{color:"primary",variant:"contained",type:"submit",children:"Create & Send"}),e.jsx(Ae,{isOpen:c.isOpen,setIsOpen:n=>B(n),invoiceInfo:{...i,subtotal:b,taxRate:k,discountRate:L,total:P},items:i==null?void 0:i.invoice_detail,onAddNextInvoice:()=>B(!1)},i.invoice_id)]})})]})})}})}function ri(){const{invoice:p}=Pe(),{invoiceMasterLoading:c,invoiceMaster:T}=De(),A=c||T===void 0,F=e.jsx(g,{sx:{height:"calc(100vh - 310px)"},children:e.jsx(_e,{})});let s=[{title:"Home",to:Ce},{title:"Invoice",to:"/apps/invoice/dashboard"},{title:"Create Invoice"}];return e.jsxs(e.Fragment,{children:[e.jsx(he,{custom:!0,heading:"New Invoice",links:s}),e.jsx(M,{children:A?F:e.jsx(ae,{lists:p,invoiceMaster:T})})]})}ae.propTypes={lists:ie.array,invoiceMaster:ie.any};export{ri as default};
